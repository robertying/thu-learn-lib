"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractJSONPResult = exports.JSONP_EXTRACTOR_NAME = exports.mapGradeToLevel = exports.trimAndDefine = exports.decodeHTML = exports.parseSemesterType = void 0;
const entities_1 = require("entities");
const types_1 = require("./types");
function parseSemesterType(n) {
    if (n === 1) {
        return types_1.SemesterType.FALL;
    }
    else if (n === 2) {
        return types_1.SemesterType.SPRING;
    }
    else if (n === 3) {
        return types_1.SemesterType.SUMMER;
    }
    else {
        return types_1.SemesterType.UNKNOWN;
    }
}
exports.parseSemesterType = parseSemesterType;
function decodeHTML(html) {
    const text = entities_1.decodeHTML(html);
    // remove strange prefixes returned by web learning
    return text.startsWith("\xC2\x9E\xC3\xA9\x65")
        ? text.substr(5)
        : text.startsWith("\x9E\xE9\x65")
            ? text.substr(3)
            : text.startsWith("\xE9\x65")
                ? text.substr(2)
                : text;
}
exports.decodeHTML = decodeHTML;
function trimAndDefine(text) {
    if (text === undefined || text === null) {
        return undefined;
    }
    const trimmed = text.trim();
    return trimmed === "" ? undefined : decodeHTML(trimmed);
}
exports.trimAndDefine = trimAndDefine;
const GRADE_LEVEL_MAP = new Map([
    [-100, "已阅"],
    [-99, "A+"],
    [-98, "A"],
    [-92, "A-"],
    [-87, "B+"],
    [-85, "优秀"],
    [-82, "B"],
    [-78, "B-"],
    [-74, "C+"],
    [-71, "C"],
    [-68, "C-"],
    [-67, "G"],
    [-66, "D+"],
    [-64, "D"],
    [-65, "免课"],
    [-63, "P"],
    [-62, "EX"],
    [-61, "免修"],
    [-60, "通过"],
    [-59, "不通过"],
    [-55, "W"],
    [-51, "I"],
    [-50, "缓考"],
    [-31, "NA"],
    [-30, "F"],
]);
function mapGradeToLevel(grade) {
    if (grade !== null && GRADE_LEVEL_MAP.has(grade)) {
        return GRADE_LEVEL_MAP.get(grade);
    }
    else {
        return undefined;
    }
}
exports.mapGradeToLevel = mapGradeToLevel;
exports.JSONP_EXTRACTOR_NAME = "thu_learn_lib_jsonp_extractor";
function extractJSONPResult(jsonp) {
    // check jsonp format
    if (!jsonp.startsWith(exports.JSONP_EXTRACTOR_NAME)) {
        throw types_1.FailReason.INVALID_RESPONSE;
    }
    // evaluate the result
    return Function(`"use strict";const ${exports.JSONP_EXTRACTOR_NAME}=(s)=>s;return ${jsonp};`)();
}
exports.extractJSONPResult = extractJSONPResult;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQXFEO0FBRXJELG1DQUFtRDtBQUVuRCxTQUFnQixpQkFBaUIsQ0FBQyxDQUFTO0lBQ3pDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNYLE9BQU8sb0JBQVksQ0FBQyxJQUFJLENBQUM7S0FDMUI7U0FBTSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDbEIsT0FBTyxvQkFBWSxDQUFDLE1BQU0sQ0FBQztLQUM1QjtTQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNsQixPQUFPLG9CQUFZLENBQUMsTUFBTSxDQUFDO0tBQzVCO1NBQU07UUFDTCxPQUFPLG9CQUFZLENBQUMsT0FBTyxDQUFDO0tBQzdCO0FBQ0gsQ0FBQztBQVZELDhDQVVDO0FBRUQsU0FBZ0IsVUFBVSxDQUFDLElBQVk7SUFDckMsTUFBTSxJQUFJLEdBQUcscUJBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixtREFBbUQ7SUFDbkQsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDO1FBQzVDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNoQixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUM7WUFDakMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQztnQkFDN0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNoQixDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ1gsQ0FBQztBQVZELGdDQVVDO0FBRUQsU0FBZ0IsYUFBYSxDQUMzQixJQUErQjtJQUUvQixJQUFJLElBQUksS0FBSyxTQUFTLElBQUksSUFBSSxLQUFL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